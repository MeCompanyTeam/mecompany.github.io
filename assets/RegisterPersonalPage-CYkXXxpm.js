import{r,u as B,j as e,L as p,s as c}from"./index-Do9N5Bdr.js";import{P as G,i as H}from"./index-DBV7NSSN.js";import{P as Y}from"./PasswordStrengthMeter-BDx7gZ8o.js";import{z as J}from"./main-B-2c47NO.js";/* empty css              */import{E as K}from"./eye-off-CzSuKnRE.js";import{E as Q}from"./eye-Cn1LezQ_.js";import"./index-KxUSDxB7.js";const oe=()=>{const[h,C]=r.useState(""),[f,E]=r.useState(""),[l,S]=r.useState(""),[g,_]=r.useState(""),[a,A]=r.useState(""),[x,F]=r.useState(""),[o,z]=r.useState(""),[n,L]=r.useState(!1),[j,d]=r.useState(!1),[v,t]=r.useState(""),[b,q]=r.useState(""),[I,R]=r.useState("PL"),[u,T]=r.useState(!1),[y,D]=r.useState(!1),[N,M]=r.useState(!1),O=B();r.useEffect(()=>{fetch("https://ipapi.co/json/").then(s=>{if(!s.ok)throw new Error(`Network response was not ok: ${s.statusText}`);return s.json()}).then(s=>{s&&s.country_code&&R(s.country_code)}).catch(s=>{console.error("Could not fetch geolocation data:",s),q("Could not determine your country. Please select it manually.")})},[]);const U=async s=>{if(s.preventDefault(),t(""),!u){t("You must accept the Terms & Privacy policy to register.");return}if(l!==g){t("Emails do not match.");return}if(a!==x){t("Passwords do not match.");return}const w=J(a);if(w.score<2){t(`Password is too weak. ${w.feedback.suggestions.join(" ")}`);return}if(o&&!H(o)){t("Please enter a valid phone number.");return}d(!0);const{data:{user:i}={},error:P}=await c.auth.signUp({email:l,password:a,options:{data:{first_name:h,last_name:f,phone:o}}});if(P){t(P.message),d(!1);return}if(i){const $=[c.functions.invoke("record-consent",{body:{user_id:i.id,consent_type:"terms_and_privacy",granted:u}}),c.functions.invoke("record-consent",{body:{user_id:i.id,consent_type:"marketing_emails",granted:y}}),c.functions.invoke("record-consent",{body:{user_id:i.id,consent_type:"personalization",granted:N}})],k=await Promise.all($);k.some(m=>m.error)&&console.error("Error saving one or more consents:",k.map(m=>m.error).filter(Boolean)),alert("Registration successful! Please check your email to verify your account."),O("/login")}d(!1)};return e.jsx("div",{className:"rp-auth-container",children:e.jsxs("div",{className:"rp-auth-form-box",children:[e.jsx("h1",{children:"Create Account"}),e.jsxs("form",{className:"rp-auth-form",onSubmit:U,children:[v&&e.jsx("p",{className:"rp-error-message",children:v}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"firstName",children:"First Name"}),e.jsx("input",{type:"text",id:"firstName",value:h,onChange:s=>C(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"lastName",children:"Last Name"}),e.jsx("input",{type:"text",id:"lastName",value:f,onChange:s=>E(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"email",id:"email",value:l,onChange:s=>S(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"confirmEmail",children:"Confirm Email"}),e.jsx("input",{type:"email",id:"confirmEmail",value:g,onChange:s=>_(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"rp-password-wrapper",children:[e.jsx("input",{type:n?"text":"password",id:"password",value:a,onChange:s=>A(s.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>L(!n),className:"rp-password-toggle","aria-label":n?"Hide password":"Show password",children:n?e.jsx(K,{size:20}):e.jsx(Q,{size:20})})]}),e.jsx(Y,{password:a})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx("input",{type:"password",id:"confirmPassword",value:x,onChange:s=>F(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"phone",children:"Phone Number (Optional)"}),b&&e.jsx("p",{className:"rp-info-message",children:b}),e.jsx("div",{className:"rp-phone-input",children:e.jsx(G,{id:"phone",international:!0,countryCallingCodeEditable:!1,defaultCountry:I,value:o,onChange:z})})]}),e.jsx("hr",{}),e.jsxs("div",{className:"form-group rp-consent-group",children:[e.jsxs("label",{className:"consent-label",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:s=>T(s.target.checked)}),e.jsxs("span",{children:["I agree to the"," ",e.jsx(p,{to:"/path/to/terms.pdf",target:"_blank",rel:"noopener noreferrer",children:"Terms of Service"})," ","and"," ",e.jsx(p,{to:"/path/to/privacy.pdf",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"}),". *"]})]}),e.jsxs("label",{className:"consent-label",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:s=>D(s.target.checked)}),e.jsx("span",{children:"I agree to receive marketing emails."})]}),e.jsxs("label",{className:"consent-label",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:s=>M(s.target.checked)}),e.jsx("span",{children:"I agree to experience personalization."})]})]}),e.jsx("button",{type:"submit",className:"rp-btn",disabled:j,children:j?"Creating Account...":"Create Account"})]}),e.jsxs("p",{className:"rp-auth-switch",children:["Already have an account? ",e.jsx(p,{to:"/login",children:"Login here"})]})]})})};export{oe as default};
