import{a as v,r as t,s as g,j as e,L as y}from"./index-Do9N5Bdr.js";import{C as N}from"./circle-check-big-BRjEOzgi.js";const C=()=>{const{user:a,loading:j}=v(),[o,l]=t.useState({terms_and_privacy:!1,marketing_emails:!1,personalization:!1}),[f,d]=t.useState(!0),[m,h]=t.useState(""),[u,c]=t.useState(""),x=t.useCallback(async()=>{if(!a)return;d(!0);const{data:s,error:r}=await g.from("consents").select("consent_type, granted").eq("user_id",a.id);if(r)console.error("Error fetching consents:",r),h("Failed to load your consent settings.");else{const n={terms_and_privacy:!1,marketing_emails:!1,personalization:!1};s.forEach(i=>{i.consent_type in n&&(n[i.consent_type]=i.granted)}),l(n)}d(!1)},[a]);t.useEffect(()=>{x()},[x]);const p=async(s,r)=>{if(!a)return;c("");const{error:n}=await g.functions.invoke("record-consent",{body:{user_id:a.id,consent_type:s,granted:r}});n?(console.error("Error updating consent:",n),h("Failed to update your settings. Please try again.")):(l(i=>({...i,[s]:r})),c("Your preferences have been updated."),setTimeout(()=>c(""),3e3))};return f||j?e.jsx("div",{children:"Loading consent settings..."}):m?e.jsx("div",{className:"error-message",children:m}):e.jsxs("div",{children:[e.jsx(y,{to:"/account/settings",className:"btn-secondary",style:{marginBottom:"2rem",display:"inline-block"},children:"â† Back to Settings"}),e.jsx("h1",{children:"Consent Management"}),e.jsx("p",{children:"Manage your privacy and communication preferences."}),u&&e.jsx("div",{className:"success-message",children:u}),e.jsxs("div",{className:"consent-settings-container",children:[e.jsxs("div",{className:"consent-item",children:[e.jsxs("div",{className:"consent-item-text",children:[e.jsx("h3",{children:"Terms & Privacy"}),e.jsx("p",{children:"You have accepted the terms and privacy policy. This is required to use the service."})]}),e.jsxs("div",{className:"consent-item-control",children:[e.jsx(N,{size:24,color:"var(--color-primary)"}),e.jsx("span",{children:"Granted"})]})]}),e.jsxs("div",{className:"consent-item",children:[e.jsxs("div",{className:"consent-item-text",children:[e.jsx("h3",{children:"Marketing Emails"}),e.jsx("p",{children:"Receive occasional emails about new features and offers."})]}),e.jsx("div",{className:"consent-item-control",children:e.jsxs("label",{className:"switch",children:[e.jsx("input",{type:"checkbox",checked:o.marketing_emails,onChange:s=>p("marketing_emails",s.target.checked)}),e.jsx("span",{className:"slider round"})]})})]}),e.jsxs("div",{className:"consent-item",children:[e.jsxs("div",{className:"consent-item-text",children:[e.jsx("h3",{children:"Personalization"}),e.jsx("p",{children:"Allow us to use your data to personalize your experience."})]}),e.jsx("div",{className:"consent-item-control",children:e.jsxs("label",{className:"switch",children:[e.jsx("input",{type:"checkbox",checked:o.personalization,onChange:s=>p("personalization",s.target.checked)}),e.jsx("span",{className:"slider round"})]})})]})]})]})};export{C as default};
