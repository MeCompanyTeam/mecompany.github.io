import{c as p,d as P,u as O,b as T,r as i,j as e,L as $,s as u}from"./index-Do9N5Bdr.js";import{u as K}from"./useQuery-Bmia-r3M.js";import{M as D}from"./Modal-C0JTwID5.js";/* empty css                 *//* empty css                    */import{K as B}from"./key-CLi_8LC7.js";import{B as Q}from"./building-IU4dt9sz.js";import{U}from"./users-BCv83-ox.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V3",key:"1lcnhd"}],["path",{d:"M19 21V9",key:"unv183"}]],W=p("chart-no-axes-column",V);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]],G=p("graduation-cap",Z);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],H=p("phone",R),J=async n=>{const{data:r,error:t}=await u.from("institutions").select(`
      *,
      profiles!institution_id (id, first_name, last_name, email, role)
    `).eq("id",n).single();if(t)throw new Error(t.message);return r&&(r.teachers=r.profiles?r.profiles.filter(c=>c.role==="teacher"):[],r.students=r.profiles?r.profiles.filter(c=>c.role==="student"):[]),r},M=(n="",r="")=>`${n.charAt(0)}${r.charAt(0)}`.toUpperCase(),X=n=>{switch(n){case"free":return"chip-free";case"standard":return"chip-standard";case"pro":return"chip-pro";case"enterprise":return"chip-enterprise";default:return""}},me=()=>{var b,_,C,w,E,k;const{institutionId:n}=P(),r=O(),t=T(),[c,h]=i.useState(!1),[S,m]=i.useState(!1),[l,j]=i.useState({}),[o,x]=i.useState(!1),[f,g]=i.useState(""),[v,y]=i.useState(""),{data:s,isLoading:z,error:N}=K({queryKey:["institution",n],queryFn:()=>J(n)});i.useEffect(()=>{s&&j(s)},[s]);const d=a=>j(A=>({...A,[a.target.name]:a.target.value})),q=async a=>{a.preventDefault(),g(""),x(!0);const{id:A,teachers:Y,students:ee,created_at:se,public_id:ae,profiles:re,...I}=l,{error:F}=await u.from("institutions").update(I).eq("id",n);F?g(F.message):(await t.invalidateQueries({queryKey:["institution",n]}),h(!1)),x(!1)},L=async()=>{y(""),x(!0);const{error:a}=await u.functions.invoke("delete-institution",{body:{institution_id:n}});a?y(a.message||"An unknown error occurred during deletion."):(m(!1),await t.invalidateQueries({queryKey:["institutions_with_counts"]}),r("/account/admin/teachers-institutions/institutions")),x(!1)};return z?e.jsx("div",{children:"Loading institution details..."}):N?e.jsxs("div",{children:["Error: ",N.message]}):e.jsxs("div",{children:[e.jsxs(D,{isOpen:S,onClose:()=>m(!1),title:"Confirm Deletion",children:[v&&e.jsx("p",{className:"error-message",children:v}),e.jsxs("p",{children:['Are you sure you want to delete "',e.jsx("strong",{children:s==null?void 0:s.name}),'"? This action is irreversible.']}),e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," Deletion will fail if any users are still assigned to this institution."]}),e.jsxs("div",{style:{marginTop:"1.5rem",display:"flex",gap:"1rem"},children:[e.jsx("button",{onClick:L,className:"btn-danger-standalone",disabled:o,children:o?"Deleting...":"I understand, Delete"}),e.jsx("button",{className:"btn-secondary",onClick:()=>m(!1),disabled:o,children:"Cancel"})]})]}),e.jsx(D,{isOpen:c,onClose:()=>h(!1),title:`Editing: ${s==null?void 0:s.name}`,children:e.jsxs("form",{className:"auth-form",onSubmit:q,style:{padding:0},children:[f&&e.jsx("p",{className:"error-message",children:f}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Institution Name *"}),e.jsx("input",{id:"name",name:"name",type:"text",value:l.name||"",onChange:d,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"address",children:"Address"}),e.jsx("input",{id:"address",name:"address",type:"text",value:l.address||"",onChange:d})]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"city",children:"City"}),e.jsx("input",{id:"city",name:"city",type:"text",value:l.city||"",onChange:d})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"zip_code",children:"Zip Code"}),e.jsx("input",{id:"zip_code",name:"zip_code",type:"text",value:l.zip_code||"",onChange:d})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"country",children:"Country (2-letter code)"}),e.jsx("input",{id:"country",name:"country",type:"text",maxLength:"2",value:l.country||"",onChange:d})]}),e.jsx("hr",{}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Contact Email"}),e.jsx("input",{id:"email",name:"email",type:"email",value:l.email||"",onChange:d})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"phone",children:"Contact Phone"}),e.jsx("input",{id:"phone",name:"phone",type:"tel",value:l.phone||"",onChange:d})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"website",children:"Website"}),e.jsx("input",{id:"website",name:"website",type:"url",value:l.website||"",onChange:d})]}),e.jsx("hr",{}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"max_teachers",children:"Max Teachers *"}),e.jsx("input",{id:"max_teachers",name:"max_teachers",type:"number",min:"1",value:l.max_teachers||1,onChange:d,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"max_students",children:"Max Students *"}),e.jsx("input",{id:"max_students",name:"max_students",type:"number",min:"1",value:l.max_students||1,onChange:d,required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"subscription_plan",children:"Subscription Plan *"}),e.jsxs("select",{id:"subscription_plan",name:"subscription_plan",value:l.subscription_plan||"free",onChange:d,required:!0,children:[e.jsx("option",{value:"free",children:"Free"}),e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"pro",children:"Pro"}),e.jsx("option",{value:"enterprise",children:"Enterprise"})]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"2rem"},children:[e.jsx("button",{type:"submit",className:"btn",disabled:o,children:o?"Saving...":"Save Changes"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>h(!1),children:"Cancel"})]})]})}),e.jsx($,{to:"/account/admin/teachers-institutions/institutions",className:"btn-secondary",style:{marginBottom:"2rem",display:"inline-block"},children:"â† Back to Institutions"}),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"manage-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:s==null?void 0:s.name}),e.jsxs("p",{className:"header-subtext",children:[e.jsx(B,{size:14})," ",s==null?void 0:s.public_id]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsx("button",{onClick:()=>h(!0),className:"btn",children:"Edit"}),e.jsx("button",{onClick:()=>m(!0),className:"btn-danger-standalone",children:"Delete"})]})]}),e.jsxs("div",{className:"details-container",children:[e.jsxs("div",{className:"detail-card",children:[e.jsxs("h3",{children:[e.jsx(Q,{size:16})," Location"]}),e.jsxs("dl",{className:"detail-list",children:[e.jsx("dt",{children:"Address"}),e.jsx("dd",{children:(s==null?void 0:s.address)||"N/A"}),e.jsx("dt",{children:"City"}),e.jsx("dd",{children:(s==null?void 0:s.city)||"N/A"}),e.jsx("dt",{children:"Zip Code"}),e.jsx("dd",{children:(s==null?void 0:s.zip_code)||"N/A"}),e.jsx("dt",{children:"Country"}),e.jsx("dd",{children:(s==null?void 0:s.country)||"N/A"})]})]}),e.jsxs("div",{className:"detail-card",children:[e.jsxs("h3",{children:[e.jsx(H,{size:16})," Contact"]}),e.jsxs("dl",{className:"detail-list",children:[e.jsx("dt",{children:"Email"}),e.jsx("dd",{children:(s==null?void 0:s.email)||"N/A"}),e.jsx("dt",{children:"Phone"}),e.jsx("dd",{children:(s==null?void 0:s.phone)||"N/A"}),e.jsx("dt",{children:"Website"}),e.jsx("dd",{children:s!=null&&s.website?e.jsx("a",{href:s.website,target:"_blank",rel:"noopener noreferrer",children:s.website}):"N/A"})]})]}),e.jsxs("div",{className:"detail-card",children:[e.jsxs("h3",{children:[e.jsx(W,{size:16})," Plan & Limits"]}),e.jsxs("dl",{className:"detail-list",children:[e.jsx("dt",{children:"Plan"}),e.jsx("dd",{children:e.jsx("span",{className:`chip ${X(s==null?void 0:s.subscription_plan)}`,children:s==null?void 0:s.subscription_plan})}),e.jsx("dt",{children:"Teachers"}),e.jsxs("dd",{children:[((b=s==null?void 0:s.teachers)==null?void 0:b.length)||0," / ",s==null?void 0:s.max_teachers]}),e.jsx("dt",{children:"Students"}),e.jsxs("dd",{children:[((_=s==null?void 0:s.students)==null?void 0:_.length)||0," / ",s==null?void 0:s.max_students]})]})]}),e.jsxs("div",{className:"detail-card",children:[e.jsxs("h2",{children:[e.jsx(U,{size:20})," Teachers (",((C=s==null?void 0:s.teachers)==null?void 0:C.length)||0,")"]}),e.jsx("div",{className:"user-list",children:(w=s==null?void 0:s.teachers)==null?void 0:w.map(a=>e.jsxs("div",{className:"user-card",children:[e.jsx("div",{className:"user-avatar",children:M(a.first_name,a.last_name)}),e.jsxs("div",{className:"user-info",children:[e.jsxs("strong",{children:[a.first_name," ",a.last_name]}),e.jsx("span",{children:a.email})]})]},a.id))})]}),e.jsxs("div",{className:"detail-card",children:[e.jsxs("h2",{children:[e.jsx(G,{size:20})," Students (",((E=s==null?void 0:s.students)==null?void 0:E.length)||0,")"]}),e.jsx("div",{className:"user-list",children:(k=s==null?void 0:s.students)==null?void 0:k.map(a=>e.jsxs("div",{className:"user-card",children:[e.jsx("div",{className:"user-avatar",children:M(a.first_name,a.last_name)}),e.jsxs("div",{className:"user-info",children:[e.jsxs("strong",{children:[a.first_name," ",a.last_name]}),e.jsx("span",{children:a.email})]})]},a.id))})]})]})]})]})};export{me as default};
